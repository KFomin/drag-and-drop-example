<div class="container">
  <mat-drawer-container class="drawer-container" autosize>
    <mat-drawer class="mat-drawer" mode="side" opened>
      <div class="cards-container">
        <h4>Elements</h4>
        <div class="card" draggable="true" (dragstart)="onDragStart($event, 'Input')">Input</div>
        <div class="card" draggable="true" (dragstart)="onDragStart($event, 'ToMorse')">
          Translate To Morse
        </div>
        <div class="card" draggable="true" (dragstart)="onDragStart($event, 'SuggestAge')">Suggest Age</div>
        <div class="card" draggable="true" (dragstart)="onDragStart($event, 'ToImageUrl')">Image</div>
        <div class="card" draggable="true" (dragstart)="onDragStart($event, 'Output')">Output</div>
      </div>
    </mat-drawer>
    <mat-drawer-content>
      <div
        class="board"
        (click)="boardClicked()"
        [id]="'draggable-cards-canvas'"
        (drop)="onDrop($event)"
        (dragover)="allowDrop($event)"
      >
        <ng-container *ngFor="let card of cards">
          <div
            cdkDrag
            cdkDragBoundary=".board"
            class="card-on-board"
            (click)="onCardClick($event, card)"
            (cdkDragMoved)="drawArrows()"
            [id]="card.id + '-card-on-board'"
            [ngClass]="{
            'open-to-connect' : creatingArrow && card.action !== 'Input' && !card.parent,
            'connectable' : card.action !== 'Input',
            'input-card' : card.action === 'Input',
            'output-card' : card.action === 'Output'
            }"
            [ngStyle]="{'position': 'absolute',
                        'left': card.position.x + 'px',
                        'top': card.position.y + 'px',
                        }"
          >
            <div cdkDragHandle class="drag-handle">
              <div class="arrow horizontal"></div>
              <div class="arrow vertical"></div>
            </div>
            <div class="drag-delete" (click)="deleteCard(card.id)">
              <div class="part-1"></div>
              <div class="part-2"></div>
            </div>
            <input type="text"
                   class="card-input"
                   aria-multiline="true"
                   [value]="card.title"
                   (input)="cardTextChanged(card.id, $event)">
            @if (card.action === 'Output') {
              @if (card.id === loadingCardId) {
                <span class="loader"></span>
              } @else {
                @switch (getParentAction(card)) {
                  @case ('SuggestAge') {
                    <p class="output-text">{{ card.value.getValue() }}</p>
                  }
                  @case ('ToImageUrl') {
                    <img alt="image from url" class="output-image" [src]="card.value.getValue()"/>
                  }
                  @default {
                    <p class="output-text">{{ card.value.getValue() }}</p>
                  }
                }
              }
            }
            @if (card.action === 'Input') {
              <textarea type="text"
                        class="card-text-area"
                        aria-multiline="true"
                        [value]="card.value.getValue()"
                        (input)="inputValueChanged(card.id, $event)">
              </textarea>
            }
            @if (canConnect(card)) {
              <div
                class="connect-arrow"
                (click)="startArrowCreation(card.id)"></div>
            }
          </div>
        </ng-container>
        <canvas #canvas class="canvas-lines"></canvas>
      </div>
    </mat-drawer-content>
  </mat-drawer-container>
</div>
